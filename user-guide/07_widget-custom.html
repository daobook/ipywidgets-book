
<!DOCTYPE html>

<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Building a Custom Widget - Email widget &#8212; 品味人生</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/w3css/4/w3mobile.css" />
    <link rel="stylesheet" type="text/css" href="../_static/w3css/4/w3pro.css" />
    <link rel="stylesheet" type="text/css" href="../_static/w3css/4/w3.css" />
    <link rel="stylesheet" type="text/css" href="../_static/xin-css/main.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "xinetzone/ipywidgets-book");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/page-logo.jfif"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Using Interact" href="08_using-interact.html" />
    <link rel="prev" title="使用 Layout 模板" href="06_layout-templates.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">品味人生</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  教程
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   用户手册
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="00_install.html">
     安装
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01_intro.html">
     简单的小部件
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_widget-list.html">
     小部件清单
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_output-widget.html">
     Output 小部件
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_widget-events.html">
     小部件事件
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05_widget-styling.html">
     布局和样式
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06_layout-templates.html">
     使用 Layout 模板
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Building a Custom Widget -  Email widget
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08_using-interact.html">
     Using Interact
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09_widget-low-level.html">
     Low Level Widget Tutorial
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10_widget-asynchronous.html">
     Asynchronous Widgets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11_embedding.html">
     Embedding Jupyter Widgets in Other Contexts than the Notebook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="layout-example.html">
     Weather map
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="test.html">
     测试
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  附录
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../faqs.html">
   常见问题
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <div class="w3-padding w3-card-4 w3-pale-green">
  <a href="https://github.com/xinetzone" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub"
      data-position="top" data-delay="50">
      <i class="fab fa-github"></i>
  </a>
  <a href="mailto:q735613050@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top"
      data-delay="50">
      <i class="fas fa-envelope-open"></i>
  </a>
  <a href="tencent://AddContact/?fromId=50&amp;fromSubId=1&amp;subcmd=all&amp;uin=735613050" class="tooltipped"
      target="_blank" data-tooltip="QQ联系我: 735613050" data-position="top" data-delay="50">
      <i class="fab fa-qq"></i>
  </a>
  <a href="https://www.zhihu.com/people/liu-xin-wei-55" class="tooltipped" target="_blank"
      data-tooltip="关注我的知乎: liu-xin-wei-55" data-position="top" data-delay="50">
      <i class="fab fa-zhihu1">知</i>
  </a>
  <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/xinet" class="tooltipped"
      data-tooltip="领英联系我: xinet" data-position="top" data-delay="50">
      <i class="fab fa-linkedin"></i>
  </a>
  <div><a href="https://github.com/xinetzone/ipywidgets-book">Jupyter Book</a> 版权所有</div>
</div> 

</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/user-guide/07_widget-custom.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/xinetzone/ipywidgets-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/xinetzone/ipywidgets-book/issues/new?title=Issue%20on%20page%20%2Fuser-guide/07_widget-custom.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/xinetzone/ipywidgets-book/main?urlpath=tree/docs/user-guide/07_widget-custom.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-a-dev-environment">
   Setup a dev environment
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#install-conda-with-miniconda">
     Install conda with miniconda
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-new-conda-environment-with-the-dependencies">
     Create a new conda environment with the dependencies
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-new-project">
   Create a new project
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initialize-the-project-from-a-cookiecutter">
     Initialize the project from a cookiecutter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#build-and-install-the-widget-for-development">
     Build and install the widget for development
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-the-installation">
     Testing the installation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implementing-the-widget">
   Implementing the widget
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#python-kernel">
   Python Kernel
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#domwidget-valuewidget-and-widget">
     DOMWidget, ValueWidget and Widget
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#view-name">
     _view_name
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sync-true-traitlets">
     sync=True traitlets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-traitlet-types">
     Other traitlet types
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#front-end-typescript">
   Front end (TypeScript)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#models-and-views">
     Models and views
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#render-method">
     Render method
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test">
   Test
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#making-the-widget-stateful">
   Making the widget stateful
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#accessing-the-model-from-the-view">
     Accessing the model from the view
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rendering-model-contents">
     Rendering model contents
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dynamic-updates">
     Dynamic updates
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Test
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learn-more">
   Learn more
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="building-a-custom-widget-email-widget">
<span id="jupyter-widget-custom"></span><h1>Building a Custom Widget -  Email widget<a class="headerlink" href="#building-a-custom-widget-email-widget" title="永久链接至标题">¶</a></h1>
<p>参考：<a class="reference external" href="https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20Custom.html">Building a Custom Widget</a></p>
<p>This tutorial shows how to build a simple email widget using the TypeScript widget cookiecutter: <a class="reference external" href="https://github.com/jupyter-widgets/widget-ts-cookiecutter">https://github.com/jupyter-widgets/widget-ts-cookiecutter</a></p>
<p><img alt="end-result" src="https://media.githubusercontent.com/media/xinetzone/ipywidgets-media/main/images/custom-widget-result.png" /></p>
<div class="section" id="setup-a-dev-environment">
<h2>Setup a dev environment<a class="headerlink" href="#setup-a-dev-environment" title="永久链接至标题">¶</a></h2>
<div class="section" id="install-conda-with-miniconda">
<h3>Install conda with miniconda<a class="headerlink" href="#install-conda-with-miniconda" title="永久链接至标题">¶</a></h3>
<p>We recommend installing <code class="docutils literal notranslate"><span class="pre">conda</span></code> using <code class="docutils literal notranslate"><span class="pre">miniconda</span></code>.</p>
<p>Instructions are available on the <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html">conda installation documentation</a>.</p>
</div>
<div class="section" id="create-a-new-conda-environment-with-the-dependencies">
<h3>Create a new conda environment with the dependencies<a class="headerlink" href="#create-a-new-conda-environment-with-the-dependencies" title="永久链接至标题">¶</a></h3>
<p>Next create a conda environment that includes:</p>
<ol class="simple">
<li><p>the latest release of JupyterLab or the classic notebook</p></li>
<li><p><a class="reference external" href="https://github.com/cookiecutter/cookiecutter">cookiecutter</a>: the tool you will use to bootstrap the custom widget</p></li>
<li><p><a class="reference external" href="https://nodejs.org">NodeJS</a>: the JavaScript runtime you'll use to
compile the web assets (e.g., TypeScript, CSS) for the custom widget</p></li>
</ol>
<p>To create the environment, execute the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda create -n ipyemail -c conda-forge jupyterlab cookiecutter nodejs yarn python
</pre></div>
</div>
<p>Then activate the environment with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda activate ipyemail
</pre></div>
</div>
</div>
</div>
<div class="section" id="create-a-new-project">
<h2>Create a new project<a class="headerlink" href="#create-a-new-project" title="永久链接至标题">¶</a></h2>
<div class="section" id="initialize-the-project-from-a-cookiecutter">
<h3>Initialize the project from a cookiecutter<a class="headerlink" href="#initialize-the-project-from-a-cookiecutter" title="永久链接至标题">¶</a></h3>
<p>It is usually recommended to bootstrap the widget with <code class="docutils literal notranslate"><span class="pre">cookiecutter</span></code>.</p>
<p>Two cookiecutter projects are currently available:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/jupyter-widgets/widget-ts-cookiecutter">widget-ts-cookiecutter</a>: To create a custom widget in TypeScript</p></li>
<li><p><a class="reference external" href="https://github.com/jupyter-widgets/widget-cookiecutter">widget-cookiecutter</a>: To create a custom widget in JavaScript</p></li>
</ul>
<p>In this tutorial, we are going to use the TypeScript cookiecutter, as many of the existing widgets are written in TypeScript.</p>
<p>To generate the project, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cookiecutter https://github.com/jupyter-widgets/widget-ts-cookiecutter
</pre></div>
</div>
<p>When prompted, enter the desired values as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>author_name <span class="o">[]</span>: Your Name
author_email <span class="o">[]</span>: your@name.net
github_project_name <span class="o">[]</span>: ipyemail
github_organization_name <span class="o">[]</span>: 
python_package_name <span class="o">[</span>ipyemail<span class="o">]</span>:
npm_package_name <span class="o">[</span>ipyemail<span class="o">]</span>: jupyter-email
npm_package_version <span class="o">[</span><span class="m">0</span>.1.0<span class="o">]</span>:
project_short_description <span class="o">[</span>A Custom Jupyter Widget Library<span class="o">]</span>: An Custom Email Widget
</pre></div>
</div>
<p>Change to the directory the cookiecutter created and list the files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ipyemail
ls
</pre></div>
</div>
<p>You should see a list like the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>appveyor.yml  css   examples  ipyemail.json  MANIFEST.in   pytest.ini  readthedocs.yml  setup.cfg  src    tsconfig.json
codecov.yml   docs  ipyemail  LICENSE.txt    package.json  README.md   setupbase.py     setup.py   tests  webpack.config.js
</pre></div>
</div>
</div>
<div class="section" id="build-and-install-the-widget-for-development">
<h3>Build and install the widget for development<a class="headerlink" href="#build-and-install-the-widget-for-development" title="永久链接至标题">¶</a></h3>
<p>The generated project should already contain a <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file with the instructions to develop the widget locally.</p>
<p>Since the widget contains a Python part, you need to install the package in editable mode:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python -m pip install -e .
</pre></div>
</div>
<p>You also need to enable the widget frontend extension.</p>
<p>If you are using JupyterLab 3.x:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># link your development version of the extension with JupyterLab</span>
jupyter labextension develop . --overwrite

<span class="c1"># rebuild extension Typescript source after making changes</span>
yarn run build
</pre></div>
</div>
<p>It is also possible to rebuild the widget automatically when there is a new change, using the <code class="docutils literal notranslate"><span class="pre">watch</span></code> script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># watch the source directory in one terminal, automatically rebuilding when needed</span>
yarn run watch
</pre></div>
</div>
<p>If you are using JupyterLab 2.x, you will need to install the <code class="docutils literal notranslate"><span class="pre">&#64;jupyter-widgets/jupyterlab-manager</span></code> extension manually:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># install the widget manager to display the widgets in JupyterLab</span>
jupyter labextension install @jupyter-widgets/jupyterlab-manager --no-build

<span class="c1"># install the local extension</span>
jupyter labextension install .
</pre></div>
</div>
<p>If you are using the Classic Notebook:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jupyter nbextension install --sys-prefix --symlink --overwrite --py ipyemail
jupyter nbextension <span class="nb">enable</span> --sys-prefix --py ipyemail
</pre></div>
</div>
</div>
<div class="section" id="testing-the-installation">
<h3>Testing the installation<a class="headerlink" href="#testing-the-installation" title="永久链接至标题">¶</a></h3>
<p>At this point, you should be able to open a notebook and create a new <code class="docutils literal notranslate"><span class="pre">ExampleWidget</span></code>.</p>
<p>To test it, execute the following in a terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># if you are using the classic notebook</span>
jupyter notebook

<span class="c1"># if you are using JupyterLab</span>
jupyter lab
</pre></div>
</div>
<p>And open <code class="docutils literal notranslate"><span class="pre">examples/introduction.ipynb</span></code>.</p>
<p>By default, the widget displays the string <code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">World</span></code> with a colored background:</p>
<p><img alt="hello-world" src="https://media.githubusercontent.com/media/xinetzone/ipywidgets-media/main/images/custom-widget-hello.png" /></p>
<p>The next steps will walk you through how to modify the existing code to transform the widget into an email widget.</p>
</div>
</div>
<div class="section" id="implementing-the-widget">
<h2>Implementing the widget<a class="headerlink" href="#implementing-the-widget" title="永久链接至标题">¶</a></h2>
<p>The widget framework is built on top of the Comm framework (short for communication).  The Comm framework is a framework that allows the kernel to send/receive JSON messages to/from the front end (as seen below).</p>
<p><img alt="Widget layer" src="https://media.githubusercontent.com/media/xinetzone/ipywidgets-media/main/images/WidgetArch.png" /></p>
<p>To learn more about how the underlying Widget protocol works, check out the <a class="reference internal" href="09_widget-low-level.html#jupyter-widget-low-level"><span class="std std-ref">Low Level Widget</span></a> documentation.</p>
<p>To create a custom widget, you need to define the widget both in the browser and in the Python kernel.</p>
</div>
<div class="section" id="python-kernel">
<h2>Python Kernel<a class="headerlink" href="#python-kernel" title="永久链接至标题">¶</a></h2>
<div class="section" id="domwidget-valuewidget-and-widget">
<h3>DOMWidget, ValueWidget and Widget<a class="headerlink" href="#domwidget-valuewidget-and-widget" title="永久链接至标题">¶</a></h3>
<p>To define a widget, you must inherit from the <code class="docutils literal notranslate"><span class="pre">DOMWidget</span></code>, <code class="docutils literal notranslate"><span class="pre">ValueWidget</span></code>, or <code class="docutils literal notranslate"><span class="pre">Widget</span></code> base class.  If you intend for your widget to be displayed, you'll want to inherit from <code class="docutils literal notranslate"><span class="pre">DOMWidget</span></code>.  If you intend for your widget to be used as an input for <a class="reference internal" href="08_using-interact.html#jupyter-using-interact"><span class="std std-ref">interact</span></a>, you'll want to inherit from <code class="docutils literal notranslate"><span class="pre">ValueWidget</span></code>. Your widget should inherit from <code class="docutils literal notranslate"><span class="pre">ValueWidget</span></code> if it has a single obvious output (for example, the output of an <code class="docutils literal notranslate"><span class="pre">IntSlider</span></code> is clearly the current value of the slider).</p>
<p>Both the <code class="docutils literal notranslate"><span class="pre">DOMWidget</span></code> and <code class="docutils literal notranslate"><span class="pre">ValueWidget</span></code> classes inherit from the <code class="docutils literal notranslate"><span class="pre">Widget</span></code> class. The <code class="docutils literal notranslate"><span class="pre">Widget</span></code> class is useful for cases in which the widget is not meant to be displayed directly in the notebook, but instead as a child of another rendering environment.  Here are some examples:</p>
<ul class="simple">
<li><p>If you wanted to create a <a class="reference external" href="https://threejs.org/">three.js</a> widget (three.js is a popular WebGL library), you would implement the rendering window as a <code class="docutils literal notranslate"><span class="pre">DOMWidget</span></code> and any 3D objects or lights meant to be rendered in that window as <code class="docutils literal notranslate"><span class="pre">Widget</span></code></p></li>
<li><p>If you wanted to create a widget that displays directly in the notebook for usage with <code class="docutils literal notranslate"><span class="pre">interact</span></code> (like <code class="docutils literal notranslate"><span class="pre">IntSlider</span></code>), you should multiple inherit from both <code class="docutils literal notranslate"><span class="pre">DOMWidget</span></code> and <code class="docutils literal notranslate"><span class="pre">ValueWidget</span></code>.</p></li>
<li><p>If you wanted to create a widget that provides a value to <code class="docutils literal notranslate"><span class="pre">interact</span></code> but does not need to be displayed, you should inherit from only <code class="docutils literal notranslate"><span class="pre">ValueWidget</span></code></p></li>
</ul>
</div>
<div class="section" id="view-name">
<h3>_view_name<a class="headerlink" href="#view-name" title="永久链接至标题">¶</a></h3>
<p>Inheriting from the DOMWidget does not tell the widget framework what front end widget to associate with your back end widget.</p>
<p>Instead, you must tell it yourself by defining specially named trait attributes, <code class="docutils literal notranslate"><span class="pre">_view_name</span></code>, <code class="docutils literal notranslate"><span class="pre">_view_module</span></code>, and <code class="docutils literal notranslate"><span class="pre">_view_module_version</span></code> (as seen below) and optionally <code class="docutils literal notranslate"><span class="pre">_model_name</span></code> and <code class="docutils literal notranslate"><span class="pre">_model_module</span></code>.</p>
<p>First let's rename <code class="docutils literal notranslate"><span class="pre">ipyemail/example.py</span></code> to <code class="docutils literal notranslate"><span class="pre">ipyemail/widget.py</span></code>.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">ipyemail/widget.py</span></code>, replace the example code with the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">DOMWidget</span><span class="p">,</span> <span class="n">ValueWidget</span><span class="p">,</span> <span class="n">register</span>
<span class="kn">from</span> <span class="nn">traitlets</span> <span class="kn">import</span> <span class="n">Unicode</span><span class="p">,</span> <span class="n">Bool</span><span class="p">,</span> <span class="n">validate</span><span class="p">,</span> <span class="n">TraitError</span>

<span class="kn">from</span> <span class="nn">._frontend</span> <span class="kn">import</span> <span class="n">module_name</span><span class="p">,</span> <span class="n">module_version</span>


<span class="nd">@register</span>
<span class="k">class</span> <span class="nc">Email</span><span class="p">(</span><span class="n">DOMWidget</span><span class="p">,</span> <span class="n">ValueWidget</span><span class="p">):</span>
    <span class="n">_model_name</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s1">&#39;EmailModel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_model_module</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_model_module_version</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">module_version</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">_view_name</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s1">&#39;EmailView&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_view_module</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_view_module_version</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">module_version</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s1">&#39;example@example.com&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">ipyemail/__init__.py</span></code>, change the import from:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.example</span> <span class="kn">import</span> <span class="n">ExampleWidget</span>
</pre></div>
</div>
<p>To:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.widget</span> <span class="kn">import</span> <span class="n">Email</span>
</pre></div>
</div>
</div>
<div class="section" id="sync-true-traitlets">
<h3>sync=True traitlets<a class="headerlink" href="#sync-true-traitlets" title="永久链接至标题">¶</a></h3>
<p>Traitlets is an IPython library for defining type-safe properties on configurable objects. For this tutorial you do not need to worry about the <em>configurable</em> piece of the traitlets machinery. The <code class="docutils literal notranslate"><span class="pre">sync=True</span></code> keyword argument tells the widget framework to handle synchronizing that value to the browser. Without <code class="docutils literal notranslate"><span class="pre">sync=True</span></code>, attributes of the widget won't be synchronized with the front-end.</p>
<div class="alert alert-info">
Syncing mutable types
<p>Please keep in mind that mutable types will not necessarily be synced when they are modified. For example appending an element to a <code class="docutils literal notranslate"><span class="pre">list</span></code> will not cause the changes to sync. Instead a new list must be created and assigned to the trait for the changes to be synced.</p>
<p>An alternative would be to use a third-party library such as <a class="reference external" href="https://github.com/rmorshea/spectate">spectate</a>, which tracks changes to mutable data types.</p>
</div></div>
<div class="section" id="other-traitlet-types">
<h3>Other traitlet types<a class="headerlink" href="#other-traitlet-types" title="永久链接至标题">¶</a></h3>
<p>Unicode, used for <code class="docutils literal notranslate"><span class="pre">_view_name</span></code>, is not the only Traitlet type, there are many more some of which are listed below:</p>
<ul class="simple">
<li><p>Any</p></li>
<li><p>Bool</p></li>
<li><p>Bytes</p></li>
<li><p>CBool</p></li>
<li><p>CBytes</p></li>
<li><p>CComplex</p></li>
<li><p>CFloat</p></li>
<li><p>CInt</p></li>
<li><p>CLong</p></li>
<li><p>CRegExp</p></li>
<li><p>CUnicode</p></li>
<li><p>CaselessStrEnum</p></li>
<li><p>Complex</p></li>
<li><p>Dict</p></li>
<li><p>DottedObjectName</p></li>
<li><p>Enum</p></li>
<li><p>Float</p></li>
<li><p>FunctionType</p></li>
<li><p>Instance</p></li>
<li><p>InstanceType</p></li>
<li><p>Int</p></li>
<li><p>List</p></li>
<li><p>Long</p></li>
<li><p>Set</p></li>
<li><p>TCPAddress</p></li>
<li><p>Tuple</p></li>
<li><p>Type</p></li>
<li><p>Unicode</p></li>
<li><p>Union</p></li>
</ul>
<p>Not all of these traitlets can be synchronized across the network, only the JSON-able traits and Widget instances will be synchronized.</p>
</div>
</div>
<div class="section" id="front-end-typescript">
<h2>Front end (TypeScript)<a class="headerlink" href="#front-end-typescript" title="永久链接至标题">¶</a></h2>
<div class="section" id="models-and-views">
<h3>Models and views<a class="headerlink" href="#models-and-views" title="永久链接至标题">¶</a></h3>
<p>The IPython widget framework front end relies heavily on <a class="reference external" href="http://backbonejs.org/">Backbone.js</a>.  Backbone.js is an MVC (model view controller) framework.  Widgets defined in the back end are automatically synchronized with Backbone.js <code class="docutils literal notranslate"><span class="pre">Model</span></code> in the front end. Each front end <code class="docutils literal notranslate"><span class="pre">Model</span></code> handles the widget data and state, and can have any number of associate <code class="docutils literal notranslate"><span class="pre">View</span></code>s. In the context of a widget the <code class="docutils literal notranslate"><span class="pre">Views</span></code> are what render objects for the user to interact with, and the Model handles communication with the Python objects.</p>
<p>On the first state push from python the synced traitlets are added automatically. The <code class="docutils literal notranslate"><span class="pre">_view_name</span></code> trait that you defined earlier is used by the widget framework to create the corresponding Backbone.js view and link that view to the model.</p>
<p>The TypeScript cookiecutter generates a file <code class="docutils literal notranslate"><span class="pre">src/widget.ts</span></code>. Open the file and rename <code class="docutils literal notranslate"><span class="pre">ExampleModel</span></code> to <code class="docutils literal notranslate"><span class="pre">EmailModel</span></code> and <code class="docutils literal notranslate"><span class="pre">ExampleView</span></code> to <code class="docutils literal notranslate"><span class="pre">EmailView</span></code>:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kr">class</span> <span class="nx">EmailModel</span> <span class="kr">extends</span> <span class="nx">DOMWidgetModel</span> <span class="p">{</span>
  <span class="nx">defaults() {</span>
    <span class="k">return</span> <span class="p">{...</span><span class="kr">super</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(),</span>
      <span class="nx">_model_name</span>: <span class="kt">EmailModel.model_name</span><span class="p">,</span>
      <span class="nx">_model_module</span>: <span class="kt">EmailModel.model_module</span><span class="p">,</span>
      <span class="nx">_model_module_version</span>: <span class="kt">EmailModel.model_module_version</span><span class="p">,</span>
      <span class="nx">_view_name</span>: <span class="kt">EmailModel.view_name</span><span class="p">,</span>
      <span class="nx">_view_module</span>: <span class="kt">EmailModel.view_module</span><span class="p">,</span>
      <span class="nx">_view_module_version</span>: <span class="kt">EmailModel.view_module_version</span><span class="p">,</span>
      <span class="nx">value</span> <span class="o">:</span> <span class="s1">&#39;Hello World&#39;</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kr">static</span> <span class="nx">serializers</span>: <span class="kt">ISerializers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">...</span><span class="nx">DOMWidgetModel</span><span class="p">.</span><span class="nx">serializers</span><span class="p">,</span>
      <span class="c1">// Add any extra serializers here</span>
    <span class="p">}</span>

  <span class="kr">static</span> <span class="nx">model_name</span> <span class="o">=</span> <span class="s1">&#39;EmailModel&#39;</span><span class="p">;</span>
  <span class="kr">static</span> <span class="nx">model_module</span> <span class="o">=</span> <span class="nx">MODULE_NAME</span><span class="p">;</span>
  <span class="kr">static</span> <span class="nx">model_module_version</span> <span class="o">=</span> <span class="nx">MODULE_VERSION</span><span class="p">;</span>
  <span class="kr">static</span> <span class="nx">view_name</span> <span class="o">=</span> <span class="s1">&#39;EmailView&#39;</span><span class="p">;</span>
  <span class="kr">static</span> <span class="nx">view_module</span> <span class="o">=</span> <span class="nx">MODULE_NAME</span><span class="p">;</span>
  <span class="kr">static</span> <span class="nx">view_module_version</span> <span class="o">=</span> <span class="nx">MODULE_VERSION</span><span class="p">;</span>
<span class="p">}</span>


<span class="kr">export</span> <span class="kr">class</span> <span class="nx">EmailView</span> <span class="kr">extends</span> <span class="nx">DOMWidgetView</span> <span class="p">{</span>
  <span class="nx">render() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;custom-widget&#39;</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">value_changed</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change:value&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">value_changed</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">value_changed() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="render-method">
<h3>Render method<a class="headerlink" href="#render-method" title="永久链接至标题">¶</a></h3>
<p>Now, override the base <code class="docutils literal notranslate"><span class="pre">render</span></code> method of the view to define custom rendering logic.</p>
<p>A handle to the widget's default DOM element can be acquired via <code class="docutils literal notranslate"><span class="pre">this.el</span></code>.  The <code class="docutils literal notranslate"><span class="pre">el</span></code> property is the DOM element associated with the view.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">src/widget.ts</span></code>, define the <code class="docutils literal notranslate"><span class="pre">_emailInput</span></code> attribute:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kr">class</span> <span class="nx">EmailView</span> <span class="kr">extends</span> <span class="nx">DOMWidgetView</span> <span class="p">{</span>
  <span class="kr">private</span> <span class="nx">_emailInput</span>: <span class="kt">HTMLInputElement</span><span class="p">;</span>
  
  <span class="nx">render() {</span>
     <span class="c1">// .....</span>
  <span class="p">}</span>
  
  <span class="c1">// .....</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, add the following logic for the <code class="docutils literal notranslate"><span class="pre">render</span></code> method:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="nx">render() {</span> 
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;email&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;example@example.com&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">);</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;custom-widget&#39;</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">value_changed</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change:value&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">value_changed</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
<span class="p">},</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="test">
<h2>Test<a class="headerlink" href="#test" title="永久链接至标题">¶</a></h2>
<p>First, run the following command to recreate the frontend bundle:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npm run build
</pre></div>
</div>
<p>If you use JupyterLab, you might want to use <code class="docutils literal notranslate"><span class="pre">jlpm</span></code> as the npm client. <code class="docutils literal notranslate"><span class="pre">jlpm</span></code> uses <code class="docutils literal notranslate"><span class="pre">yarn</span></code> under the hood as the package manager. The main difference compared to <code class="docutils literal notranslate"><span class="pre">npm</span></code> is that <code class="docutils literal notranslate"><span class="pre">jlpm</span></code> will generate a <code class="docutils literal notranslate"><span class="pre">yarn.lock</span></code> file for the dependencies, instead of <code class="docutils literal notranslate"><span class="pre">package-lock.json</span></code>. With <code class="docutils literal notranslate"><span class="pre">jlpm</span></code> the command is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jlpm run build
</pre></div>
</div>
<p>After reloading the page, you should be able to display your widget just like any other widget now:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ipyemail</span> <span class="kn">import</span> <span class="n">Email</span>

<span class="n">Email</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="making-the-widget-stateful">
<h2>Making the widget stateful<a class="headerlink" href="#making-the-widget-stateful" title="永久链接至标题">¶</a></h2>
<p>There is not much that you can do with the above example that you can't do with the IPython display framework.  To change this, you will make the widget stateful.  Instead of displaying a static &quot;<a class="reference external" href="mailto:example&#37;&#52;&#48;example&#46;com">example<span>&#64;</span>example<span>&#46;</span>com</a>&quot; email address, it will display an address set by the back end.  First you need to add a traitlet in the back end.  Use the name of <code class="docutils literal notranslate"><span class="pre">value</span></code> to stay consistent with the rest of the widget framework and to allow your widget to be used with interact.</p>
<p>We want to be able to avoid the user to write an invalid email address, so we need a validator using traitlets.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">DOMWidget</span><span class="p">,</span> <span class="n">ValueWidget</span><span class="p">,</span> <span class="n">register</span>
<span class="kn">from</span> <span class="nn">traitlets</span> <span class="kn">import</span> <span class="n">Unicode</span><span class="p">,</span> <span class="n">Bool</span><span class="p">,</span> <span class="n">validate</span><span class="p">,</span> <span class="n">TraitError</span>

<span class="kn">from</span> <span class="nn">._frontend</span> <span class="kn">import</span> <span class="n">module_name</span><span class="p">,</span> <span class="n">module_version</span>


<span class="nd">@register</span>
<span class="k">class</span> <span class="nc">Email</span><span class="p">(</span><span class="n">DOMWidget</span><span class="p">,</span> <span class="n">ValueWidget</span><span class="p">):</span>
    <span class="n">_model_name</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s1">&#39;EmailModel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_model_module</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_model_module_version</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">module_version</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">_view_name</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s1">&#39;EmailView&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_view_module</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_view_module_version</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">module_version</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s1">&#39;example@example.com&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">disabled</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable or disable user changes.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># Basic validator for the email value</span>
    <span class="nd">@validate</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_valid_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proposal</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">proposal</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s1">&#39;Invalid email value: it must contain an &quot;@&quot; character&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proposal</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span><span class="s1">&#39;Invalid email value: it must contain at least one &quot;.&quot; character&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">proposal</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="accessing-the-model-from-the-view">
<h3>Accessing the model from the view<a class="headerlink" href="#accessing-the-model-from-the-view" title="永久链接至标题">¶</a></h3>
<p>To access the model associated with a view instance, use the <code class="docutils literal notranslate"><span class="pre">model</span></code> property of the view.  <code class="docutils literal notranslate"><span class="pre">get</span></code> and <code class="docutils literal notranslate"><span class="pre">set</span></code> methods are used to interact with the Backbone model.  <code class="docutils literal notranslate"><span class="pre">get</span></code> is trivial, however you have to be careful when using <code class="docutils literal notranslate"><span class="pre">set</span></code>.  After calling the model <code class="docutils literal notranslate"><span class="pre">set</span></code> you need call the view's <code class="docutils literal notranslate"><span class="pre">touch</span></code> method.  This associates the <code class="docutils literal notranslate"><span class="pre">set</span></code> operation with a particular view so output will be routed to the correct cell.  The model also has an <code class="docutils literal notranslate"><span class="pre">on</span></code> method, which allows you to listen to events triggered by the model (like value changes).</p>
</div>
<div class="section" id="rendering-model-contents">
<h3>Rendering model contents<a class="headerlink" href="#rendering-model-contents" title="永久链接至标题">¶</a></h3>
<p>By replacing the string literal with a call to <code class="docutils literal notranslate"><span class="pre">model.get</span></code>, the view will now display the value of the back end upon display.  However, it will not update itself to a new value when the value changes.</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kr">class</span> <span class="nx">EmailView</span> <span class="kr">extends</span> <span class="nx">DOMWidgetView</span> <span class="p">{</span>
  <span class="nx">render() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;email&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
      
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">_emailInput</span>: <span class="kt">HTMLInputElement</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamic-updates">
<h3>Dynamic updates<a class="headerlink" href="#dynamic-updates" title="永久链接至标题">¶</a></h3>
<p>To get the view to update itself dynamically, register a function to update the view's value when the model's <code class="docutils literal notranslate"><span class="pre">value</span></code> property changes.  This can be done using the <code class="docutils literal notranslate"><span class="pre">model.on</span></code> method.  The <code class="docutils literal notranslate"><span class="pre">on</span></code> method takes three parameters, an event name, callback handle, and callback context.   The Backbone event named <code class="docutils literal notranslate"><span class="pre">change</span></code> will fire whenever the model changes.  By appending <code class="docutils literal notranslate"><span class="pre">:value</span></code> to it, you tell Backbone to only listen to the change event of the <code class="docutils literal notranslate"><span class="pre">value</span></code> property (as seen below).</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kr">class</span> <span class="nx">EmailView</span> <span class="kr">extends</span> <span class="nx">DOMWidgetView</span> <span class="p">{</span>
  <span class="nx">render() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;email&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">);</span>

    <span class="c1">// Python -&gt; JavaScript update</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change:value&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onValueChanged</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change:disabled&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onDisabledChanged</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">_onValueChanged() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">_onDisabledChanged() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">_emailInput</span>: <span class="kt">HTMLInputElement</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This allows us to update the value from the Python kernel to the views. Now to get the value updated from the front-end to the Python kernel (when the input is not disabled) we set the value on the frontend model using <code class="docutils literal notranslate"><span class="pre">model.set</span></code> and then sync the frontend model with the Python object using <code class="docutils literal notranslate"><span class="pre">model.save_changes</span></code>.</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kr">class</span> <span class="nx">EmailView</span> <span class="kr">extends</span> <span class="nx">DOMWidgetView</span> <span class="p">{</span>
  <span class="nx">render() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;email&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">);</span>

    <span class="c1">// Python -&gt; JavaScript update</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change:value&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onValueChanged</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change:disabled&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onDisabledChanged</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="c1">// JavaScript -&gt; Python update</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">onchange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onInputChanged</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">_onValueChanged() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">_onDisabledChanged() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">_onInputChanged() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_emailInput</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">save_changes</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kr">private</span> <span class="nx">_emailInput</span>: <span class="kt">HTMLInputElement</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h2>Test<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>To instantiate a new widget:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">email</span> <span class="o">=</span> <span class="n">Email</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;john.doe@domain.com&#39;</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">email</span>
</pre></div>
</div>
<p>To get the value of the widget:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">email</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p>To set the value of the widget:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">email</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;jane.doe@domain.com&#39;</span>
</pre></div>
</div>
<p>The end result should look like the following:</p>
<p><img alt="end-result" src="https://media.githubusercontent.com/media/xinetzone/ipywidgets-media/main/images/custom-widget-result.png" /></p>
</div>
<div class="section" id="learn-more">
<h2>Learn more<a class="headerlink" href="#learn-more" title="永久链接至标题">¶</a></h2>
<p>As we have seen in this tutorial, starting from a cookiecutter project is really useful to quickly prototype a custom widget.</p>
<p>Two cookiecutter projects are currently available:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/jupyter-widgets/widget-ts-cookiecutter">widget-ts-cookiecutter</a>: To create a custom widget in TypeScript</p></li>
<li><p><a class="reference external" href="https://github.com/jupyter-widgets/widget-cookiecutter">widget-cookiecutter</a>: To create a custom widget in JavaScript</p></li>
</ul>
<p>If you want to learn more about building custom widgets, you can also check out the rich ecosystem of third-party widgets:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bqplot/bqplot">bqplot</a>: Interactive 2-D plotting</p></li>
<li><p><a class="reference external" href="https://github.com/jupyter-widgets/ipyleaflet">ipyleaflet</a>: Interactive maps</p></li>
<li><p><a class="reference external" href="https://github.com/martinRenou/ipycanvas">ipycanvas</a>: Interactive Canvas</p></li>
<li><p><a class="reference external" href="https://github.com/maartenbreddels/ipyvolume">ipyvolume</a>: Interactive 3-D plotting</p></li>
<li><p><a class="reference external" href="https://github.com/maartenbreddels/ipywebrtc">ipywebrtc</a>: WebRTC and MediaStream API in Jupyter</p></li>
<li><p><a class="reference external" href="https://github.com/QuantStack/ipysheet">ipysheet</a>: Spreadsheet Widget</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ai"
        },
        kernelOptions: {
            kernelName: "ai",
            path: "./user-guide"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ai'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="06_layout-templates.html" title="previous page">使用 Layout 模板</a>
    <a class='right-next' id="next-link" href="08_using-interact.html" title="next page">Using Interact</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By xinetzone<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>